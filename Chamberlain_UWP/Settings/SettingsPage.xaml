<Page
    x:Class="Chamberlain_UWP.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Chamberlain_UWP"
    xmlns:local2="using:Chamberlain_UWP.Settings"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    Background="{ThemeResource NavigationViewExpandedPaneBackground}">

    <Grid>
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="VisualStateGroup">
                <VisualState x:Name="Phone">
                    <VisualState.Setters>
                        <Setter Target="PageTitleTextBlock.(FrameworkElement.Margin)">
                            <Setter.Value>
                                <Thickness>24,48,24,12</Thickness>
                            </Setter.Value>
                        </Setter>
                        <Setter Target="LayoutPanel.(FrameworkElement.Margin)">
                            <Setter.Value>
                                <Thickness>24,0,24,24</Thickness>
                            </Setter.Value>
                        </Setter>
                    </VisualState.Setters>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                </VisualState>
                <VisualState x:Name="Desktop">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="768"/>
                    </VisualState.StateTriggers>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>
        <TextBlock Name="PageTitleTextBlock"
                   Text="设置"
                   Margin="48,48,48,12"
                   Style="{ThemeResource TitleTextBlockStyle}"/>
        <ScrollViewer Grid.Row="1">
            <!--设置面板-->
            <StackPanel x:Name="LayoutPanel" Margin="48,0,48,48" Grid.Row="1">
                <!--应用设置-->
                <TextBlock Text="后台任务" Style="{StaticResource SubtitleTextBlockStyle}"/>
                <StackPanel Margin="0,0,0,24">
                    <muxc:NumberBox Name="TriggerSpanComboBox" Header="后台唤醒间隔（分钟）"
                                    SpinButtonPlacementMode="Inline"
                                    HorizontalAlignment="Left"
                                    SmallChange="10" LargeChange="100" Minimum="15"
                                    Width="200" Margin="0,12,0,0"
                                    Text="{x:Bind UpdateTriggerInterval, Mode=TwoWay}"/>
                    <ToggleSwitch Header="开启通知" Name="NotificationSwitch"
                                  Margin="0,12,0,0"
                                  IsOn="{x:Bind IsNotificationEnabled, Mode=TwoWay}"/>
                    <ToggleSwitch Header="显示通知显示阻塞信息"
                                  Margin="0,12,0,0"
                                  IsOn="{x:Bind IsNotificationBlockingVisible, Mode=TwoWay}"
                                  Visibility="{Binding IsOn, ElementName=NotificationSwitch}"/>
                </StackPanel>

                <TextBlock Text="同步" Style="{StaticResource SubtitleTextBlockStyle}"/>
                <StackPanel Margin="0,0,0,24">
                    <ToggleSwitch x:Name="SettingSyncSwitch" Header="应用设置跨设备同步" 
                                  Margin="0,12,0,0" 
                                  IsOn="{x:Bind IsSettingsRoamingEnabled, Mode=TwoWay}"
                                  Toggled="SettingSyncSwitch_Toggled"/>
                </StackPanel>

                <TextBlock Text="组件设置" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,12"/>

                <muxc:Expander Name="ReminderExpander"
                               IsExpanded="False" ExpandDirection="Down"
                               VerticalAlignment="Top" HorizontalAlignment="Stretch"
                               HorizontalContentAlignment="Stretch">
                    <muxc:Expander.Header>
                        <RelativePanel>
                            <FontIcon Name="ReminderIcon" FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                      Glyph="&#xE73A;" FontSize="16"
                                      RelativePanel.AlignVerticalCenterWithPanel="True"/>
                            <TextBlock Text="提醒" Margin="12,0,0,0"
                                       RelativePanel.RightOf="ReminderIcon"
                                       RelativePanel.AlignVerticalCenterWithPanel="True"/>
                        </RelativePanel>
                    </muxc:Expander.Header>
                    <StackPanel>
                        <TextBlock Text="指定位置存放数据"
                                   Margin="0,0,0,8"
                                   Style="{ThemeResource BaseTextBlockStyle}"/>
                        <StackPanel>
                            <TextBlock Name="SelectedFolderPathText" VerticalAlignment="Center"/>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <Button Name="SetReminderFolderButton" Content="打开文件夹"
                                        Click="SetReminderFolderButton_Click"/>
                                <Button Name="DeleteSelectedFolderButton" Content="清除"
                                        Margin="8,0,0,0"
                                        Click="DeleteSelectedFolderButton_Click"/>
                            </StackPanel>
                        </StackPanel>

                        <TextBlock Text="导入Reminder(JSON)"
                                   Margin="0,12,0,8"
                                   Style="{ThemeResource BaseTextBlockStyle}"/>
                        <muxc:InfoBar Name="ImportReminderInfoBar" Title="" IsOpen="True"
                                      Severity="Success" Visibility="Collapsed"/>
                        <Grid ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Name="ImportReminderTextBox"
                                     PlaceholderText="JSON格式文本（支持文件拖拽）"
                                     MaxHeight="200"
                                     TextWrapping="Wrap"
                                     DragOver="ImportReminderTextBox_DragOver"
                                     Drop="ImportReminderTextBox_Drop"/>
                            <Button Name="ImportReminderButton" Content="导入"
                                    Grid.Column="1" VerticalAlignment="Top"
                                    HorizontalAlignment="Right"
                                    Click="ImportReminderButton_Click"/>
                        </Grid>

                        <TextBlock Text="从JSON文件中读取数据"
                                   Margin="0,12,0,8"
                                   Style="{ThemeResource BaseTextBlockStyle}"/>
                        <RelativePanel>
                            <Button Content="打开文件" Name="OpenFileButton" Click="OpenFileButton_Click"/>
                            <TextBlock Name="OpenFileTextBlock"
                                       Margin="8,0,0,0"
                                       IsTextSelectionEnabled="True"
                                       RelativePanel.RightOf="OpenFileButton"
                                       RelativePanel.AlignVerticalCenterWithPanel="True"/>
                        </RelativePanel>
                        <TextBlock Text="清除Reminder数据"
                                   Margin="0,12,0,8"
                                   Style="{ThemeResource BaseTextBlockStyle}"/>
                        <Button Content="删除" Name="DeleteFlyoutButton" Click="DeleteFlyoutButton_Click">
                            <Button.Flyout>
                                <Flyout>
                                    <StackPanel>
                                        <TextBlock Text="⚠将会删除数据文件。是否继续？" 
                                                   Margin="0,0,0,12" 
                                                   Style="{ThemeResource BaseTextBlockStyle}" />
                                        <Button Content="确认删除" Name="DeleteReminderDataButton"
                                                Click="DeleteReminderDataButton_Click"/>
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                </muxc:Expander>

                <muxc:Expander Name="DebugOptionExpander" Header="调试选项"
                               IsExpanded="False" ExpandDirection="Down"
                               Margin="0,12,0,0"
                               VerticalAlignment="Top" 
                               HorizontalAlignment="Stretch"
                               HorizontalContentAlignment="Stretch"
                               Expanding="DebugOptionExpander_Expanding">
                    <StackPanel>
                        <TextBlock Text="Reminder" Style="{ThemeResource BaseTextBlockStyle}"/>
                        <TextBlock Text="JSON（仅输出）"
                                   Margin="0,8,0,8"
                                   Style="{ThemeResource BodyTextBlockStyle}"/>
                        <TextBox Name="ReminderJsonTextBox"
                                 MaxHeight="200"
                                 TextWrapping="Wrap"/>

                        <TextBlock Text="保存数据"
                                   Margin="0,12,0,0"
                                   Style="{ThemeResource BodyTextBlockStyle}"/>
                        <StackPanel Margin="0,8,0,0">
                            <Button Name="ReminderSave" Content="保存Reminder" Click="ReminderSave_Click"/>
                            <TextBox Name="ReminderSaveTextBox" Margin="0,8,0,0" PlaceholderText="文件保存路径（仅输出）"/>
                        </StackPanel>
                    </StackPanel>
                </muxc:Expander>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
